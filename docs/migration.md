## Migration guide

The following section is a short guide on how to migrate from Gulp-based build scripts.

### `solution-config.json`

* `configurationTransform.AlwaysApplyName` now defaults to "Always" by convention (case insensitive).
* The latest version of `MSBuild.exe` installed on the system is now automatically used for compilation.
* The `configs` section has been replaced with `./pentia/user-settings.json`. See [Solution specific user settings](#solution-specific-user-settings).

#### Before - `solution-config.json`
```json
{
    "configurationTransform": {
      "AlwaysApplyName": "always"
    },
    "msbuild": {
      "showError": true,
      "showStandardOutput": true,
      "toolsversion": 14.0,
      "verbosity": "Minimal"
    },
    "configs": [
      {
        "name": "debug",
        "rootFolder": "C:\\Websites\\HC.website",
        "websiteRoot" :"C:\\Websites\\HC.website\\Website",
        "websiteDataRoot" :"C:\\Websites\\HC.website\\Data"
      },
      {
        "name": "development",
        "rootFolder": "Websites",
        "websiteRoot" :"Websites\\Website",
        "websiteDataRoot" :"Websites\\Data"
      }
    ]
}
```

#### After - `./pentia/user-settings.json`
This file is automatically generated and updated.
```json
{
    "webrootOutputPath":  "C:\\Websites\\HC.website\\Website",
    "dataOutputPath":  "C:\\Websites\\HC.website\\Data",
    "buildConfiguration":  "debug"
}
```

### `solution-packages.json`

This file has been replaced with `runtime-dependencies.config`. See [Runtime dependencies](#runtime-dependencies).

#### Before - `solution-packages.json`
```json
{
    "packages":[
        {
            "packageName": "Sitecore.Full",
            "version": "8.2.170728",
            "location": "http://tund/nuget/FullSitecore/"  
        },
        {
            "packageName": "Sitecore.Publishing.Module",
            "version": "2.0.0",
            "location": "http://tund/nuget/sitecore/"  
        }
    ]
}
```

#### After - `runtime-dependencies.config`
```xml
<?xml version="1.0" encoding="utf-8"?>
<packages>
  <package id="Sitecore.Full" version="8.2.170728" />
  <package id="Sitecore.Publishing.Module" version="2.0.0" />
</packages>
```

### `gulpfile.js`

The scripts called from within `gulpfile.js` (e.g. `Setup-Development-Environment`, which in turn calls `delete-website`, `install-packages` etc.) have been replaced with `Publish-ConfiguredHelixSolution`. 
Hence these parts of `gulpfile.js` are largely obsolete.

#### Before - `gulpfile.js`
```javascript
var gulp = require('gulp');
var runSequence = require('run-sequence');
var publish = require('@pentia/publish-projects');
var packagemanager = require('@pentia/sitecore-package-manager');
var configTransform = require('@pentia/configuration-transformer');
var watchprojects = require('@pentia/watch-publish-projects');
var powershell = require('./node_modules/@pentia/publish-projects/modules/powershell')
var rimraf = require('rimraf');
var fs = require('fs-extra');

gulp.task('Setup-Development-Environment', function(callback) {
  runSequence(
    'delete-website',
    'install-packages',
    'publish-all-layers',
    'apply-xml-transform',
    'copy-license',
    'sync',
    callback);
});

gulp.task('sync', function(callback) {
  powershell.runAsync("./autosync-scripts/autosync-unicorn.ps1", "", callback);
});

gulp.task('setup', function(callback) {
  runSequence('Setup-Development-Environment',
    callback);
});

gulp.task('delete-website', function(callback) {
  rimraf('C:\\websites\\HC.website\\Website', callback);
});

gulp.task('copy-license', function() {
  fs.copy('\\\\buildlibrary\\library\\Sitecore License\\Pentia 8.x\\www\\Data\\pentia.license.xml', 'C:\\Websites\\HC.website\\Data\\license.xml');
});
```

#### After - `gulpfile.js`
```javascript
var gulp = require('gulp');
var runSequence = require('run-sequence');
var powershell = require('./node_modules/@pentia/publish-projects/modules/powershell');
var fs = require('fs-extra');

gulp.task('Setup-Development-Environment', function(callback) {
  runSequence('publish-helix-solution', 'copy-license', 'sync',  callback);
});

gulp.task('publish-helix-solution', function(callback) {
  powershell.runAsync("Publish-ConfiguredHelixSolution", "", callback);
});

gulp.task('copy-license', function() {
  var licenseFile = '\\\\buildlibrary\\library\\Sitecore License\\Pentia 8.x\\www\\Data\\pentia.license.xml';
  fs.copy(licenseFile, 'C:\\Websites\\HC.website\\Data\\license.xml');
});

gulp.task('sync', function(callback) {
  powershell.runAsync("./autosync-scripts/autosync-unicorn.ps1", "", callback);
});
```